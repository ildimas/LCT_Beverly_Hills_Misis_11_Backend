# LCT_Beverly_Hills_Misis_11_Backend
Бэкэнд веб сервиса для распределения и расчета эффективности расходов команды (11 Задача) команды Beverly Hills MISIS

## Фронтэнд репозиторий
[Frontend](https://github.com/Instarlin/washington-silver?tab=readme-ov-file)

## Главные цели проекта:

* Создание веб приложения для манимпуляций с объектами задачи

* Реализация алгоритма генерации распределений по предоставленным данным

* Разработка системы прогнозирования затрат на основе машинного обучения

* Реализация творческих амбиций команды в реализации пользовательского интерфейса



## Инструкция по локальной развертке проекта:
1 Убедитесь что ваша система соответствует требованиям:

```
Установлен docker engine

Python>=3.12.3

WSL, GIT Bash, Cygwin - для запуска sh скриптов
```


2 Установим все необходимые библиотеки:
2.1 Перейдите в директорию API и запустите следующую команду

```
pip install -r requirements.txt
```

2.2 Перейдите в директорию Scripts и запуститите скрипт dev_build.sh с помощью команды: 

```
sh dev_build.sh
```

3 Дождитесь сборки контейнеров и перейдите по адресу < 127.0.0.1:8888/api/docs > для просмотра документации и тригера эндпоинтов

## Основной функционал проекта

* **Алгоритм распределения расходов:** Реализация алгоритма для эффективного распределения расходов между различными счетами и справочниками на основе заданных правил.

* **Прогнозирование расходов:** Использование ML-модели для прогнозирования расходов на 12 месяцев вперёд, что позволяет заранее планировать финансовые потоки.

## Технологии и инструменты
![FastAPI](https://img.shields.io/badge/FastAPI-005571?style=for-the-badge&logo=fastapi)

**FastAPI** — фреймворк для Python, который был выбран благодаря своей высокой скорости и поддержке асинхронных запросов

![Nginx](https://img.shields.io/badge/nginx-%23009639.svg?style=for-the-badge&logo=nginx&logoColor=white)

**Nginx** — используется для проксирования HTTP-запросов, что обеспечивает надежность и масштабируемость системы.

![Docker](https://img.shields.io/badge/docker-%230db7ed.svg?style=for-the-badge&logo=docker&logoColor=white)

**Docker** — контейнеризация проекта для удобного и быстрого разворачивания системы в различных средах.

![Postgres](https://img.shields.io/badge/Postgres-%23316192.svg?style=for-the-badge&logo=postgresql&logoColor=white)

**Postgres** — СУБД для хранения данных

![React](https://img.shields.io/badge/react-%2320232a.svg?style=for-the-badge&logo=react&logoColor=%2361DAFB)

**React** — используется для создания динамичного и удобного интерфейса для фронтенд-части проекта.

![Vite](https://img.shields.io/badge/vite-%23646CFF.svg?style=for-the-badge&logo=vite&logoColor=white)

**Vite** — инструмент для настройки среды разработки и сборки фронтенда, что значительно ускоряет процесс разработки.

![Prophet](https://img.shields.io/badge/-Prophet-3B5998?style=for-the-badge)

**Prophet** — библиотека для прогнозирования временных рядов, которая была использована для предсказания расходов компании.

## Команда проекта

Backend - [ildimas](https://github.com/ildimas)

Frontend - [Instarlin](https://github.com/Instarlin)

ML - [BelugaChan](https://github.com/BelugaChan)

Разработчик алгоритмов - [SuperB1aze](https://github.com/SuperB1aze)

Тестировщик - Владимир Б.

## Технологическая часть проекта

&emsp;Для реализации бэкенда мы использовали **FastAPI** в связке с **PostgreSQL** для хранения данных. **FastAPI** был выбран благодаря своей высокой производительности и поддержке асинхронных операций, что позволяет эффективно обрабатывать запросы. В качестве базы данных был выбран **PostgreSQL**, поскольку это надёжная и масштабируемая СУБД с широкими возможностями для хранения и обработки больших объёмов данных.

&emsp;Модели машинного обучения для прогнозирования расходов были реализованы с помощью **Prophet** — мощного инструмента для прогнозирования временных рядов. Этот инструмент идеально подходит для работы с данными, которые содержат сезонные колебания и неожиданные изменения. **Prophet** позволяет создавать гибкие и точные модели, что помогает нам прогнозировать будущие расходы и доходы компании.

&emsp;Клиентская часть приложения была разработана с использованием **React**, что позволяет создавать динамичные и отзывчивые интерфейсы. Мы также использовали **Vite** для настройки среды разработки и ускорения сборки проекта.

&emsp;По части инфраструктуры, всё наше решение разбито на **4** Docker-контейнера, каждый из которых отвечает за отдельную часть системы. Прокси-сервер **Nginx** используется для маршрутизации запросов между контейнерами. Такой подход позволяет нам легко масштабировать и разворачивать приложение. Кроме того, мы заложили потенциал для реализации балансировщика нагрузки и возможного дробления сервиса бэкенда на более мелкие, независимые сервисы в будущем.

## Прогнозирование с помощью Prophet
&emsp;Одним из ключевых аспектов нашего сервиса является возможность прогнозирования финансовых показателей. С помощью встроенных аналитических инструментов и моделей машинного обучения, наш сервис может предсказывать будущие расходы и доходы на основе данных прошлых лет. Это позволяет компании заблаговременно планировать свои финансовые стратегии, избегать неожиданных затрат и своевременно корректировать бюджет.

### ML-технологии: Prophet
&emsp;**Prophet** — это мощный инструмент, предназначенный для прогнозирования временных рядов. Этот инструмент идеально подходит для обработки данных, содержащих сезонные компоненты, а также неожиданные изменения и колебания. Prophet позволяет с легкостью создавать сложные модели, которые способны предсказывать будущее поведение временных рядов с высокой точностью и гибкостью.

Данные, на основе которых были обучены модели, включают в себя следующие компоненты:

* **Дата отражения в учетной системе** — это дата, когда данные были записаны и зафиксированы в учетной системе.
* **Сумма распределения** — это сумма, распределенная для каждого отдельного здания, учитывая различные факторы и условия.
* **Площадь** — площадь здания, которая используется в модели в качестве регрессора, влияющего на прогнозы.

> [!NOTE]
> В нашем конкретном случае было создано и обучено множество моделей, каждая из которых предназначена для одного конкретного здания. Это позволило нам получить возможность гибко и точно предсказывать 
> сумму распределения для различных временных промежутков, учитывая все особенности и характеристики каждого отдельного здания. 

## Описание API

### Раздел **User**

1. **HTTP метод POST**: `/api/user`  
   Создает нового пользователя. На вход подаются два параметра:
   - `email`: **строка**, обязательный параметр.
   - `password`: **строка** (не менее 8 символов), обязательный параметр.

2. **HTTP метод GET**: `/api/user`  
   Возвращает данные авторизованного пользователя.

3. **HTTP метод DELETE**: `/api/user`  
   Удаляет существующего пользователя. На вход подается один параметр:
   - `user_id`: **UUID**, идентификатор пользователя, который будет удален.

---

### Раздел **auth (Authentication)**

1. **HTTP метод POST**: `/api/auth/token`  
   Генерирует токен доступа. На вход подаются два обязательных параметра:
   - `username`: **строка**, обязательный параметр.
   - `password`: **строка**, обязательный параметр.

---

### Раздел **category**

1. **HTTP метод GET**: `/api/category`  
   Возвращает все категории для авторизованного пользователя.

2. **HTTP метод POST**: `/api/category/`  
   Создает новую категорию. На вход подается имя категории:
   - `name`: **строка**, обязательный параметр.

3. **HTTP метод DELETE**: `/api/category/`  
   Удаляет существующую категорию. На вход подается название категории:
   - `name`: **строка**, обязательный параметр.

---

### Раздел **Allocation**

1. **HTTP метод GET**: `/api/allocation/`  
   Возвращает все аллокации пользователя. Включает параметр запроса для фильтрации:
   - `category_name`: **строка**, ограничивает результаты по названию категории.

2. **HTTP метод POST**: `/api/allocation/`  
   Создает новую аллокацию. На вход подаются два обязательных параметра:
   - `name`: **строка**, название аллокации.
   - `category_name`: **строка**, название категории.

3. **HTTP метод DELETE**: `/api/allocation`  
   Удаляет существующую аллокацию. На вход подаются два обязательных параметра:
   - `name`: **строка**, название аллокации.
   - `category_name`: **строка**, название категории.

4. **HTTP метод DELETE**: `/api/allocation/delete_by_id`  
   Удаляет аллокацию по UUID. На вход подается:
   - `id`: **UUID**, идентификатор аллокации.

5. **HTTP метод DELETE**: `/api/allocation/process`  
   Запускает процесс создания аллокации по ассоциированным объектам. На вход подаются:
   - `id`: **UUID**, идентификатор аллокации.
   - `rules`: **словарь** с правилами.

---

### Раздел **Bills_And_Refs**

1. **HTTP метод POST**: `/api/bills/`  
   Создает новый счет для оплаты. На вход подаются два параметра:
   - `alloc_id`: **UUID**, идентификатор аллокации.
   - `bills_to_pay`: **бинарный файл**, счет для оплаты.

2. **HTTP метод POST**: `/api/bills/refs`  
   Создает справочник с файлами данных. На вход подаются параметры:
   - `alloc_id`: **UUID**, идентификатор аллокации.
   - `contracts`: **файл**, данные по контрактам.
   - `codes`: **файл** с кодами.
   - `fixedassets`: **файл** с данными о основных средствах.
   - `building_squares`: **файл** с данными по площадям зданий.
   - `contracts_to_building`: **файл** с соответствиями контрактов и зданий.

3. **HTTP метод DELETE**: `/api/bills/refs`  
   Удаляет справочники для указанной аллокации.

4. **HTTP метод DELETE**: `/api/bills/`  
   Удаляет счета на оплату для указанной аллокации.

---

### Раздел **Predictions**

1. **HTTP метод POST**: `/api/predict/search`  
   Реализует автоподбор следующего символа на фронтенде. На вход подаются:
   - `content`: **строка**, ввод пользователя.
   - `alloc_id`: **UUID**, идентификатор аллокации.
   - `search_attribute`: **строка**, параметр для поиска.

2. **HTTP метод POST**: `/api/predict/predict`  
   Запускает процесс прогнозирования. На вход подается:
   - `alloc_id`: **UUID**, идентификатор аллокации.

3. **HTTP метод POST**: `/api/predict/main_ledger`  
   Реализует поиск спрогнозированных объектов по основному счету. На вход подаются:
   - `searchable_value`: **строка**, значение для поиска.
   - `alloc_id`: **UUID**, идентификатор аллокации.
   - `months_to_show`: **целое число**, количество месяцев, на которые будет показан прогноз.
   - `filter_rules`: **словарь** с фильтрами для прогноза.

4. **HTTP метод POST**: `/api/predict/fixed_assets_class`  
   Реализует поиск спрогнозированных объектов по классу основных средств. На вход подаются:
   - `searchable_value`: **строка**, значение для поиска.
   - `alloc_id`: **UUID**, идентификатор аллокации.
   - `months_to_show`: **целое число**, количество месяцев, на которые будет показан прогноз.
   - `filter_rules`: **словарь** с фильтрами для прогноза.

5. **HTTP метод POST**: `/api/predict/fixed_assets_id`  
   Реализует поиск спрогнозированных объектов по основным средствам. На вход подаются:
   - `searchable_value`: **строка**, значение для поиска.
   - `alloc_id`: **UUID**, идентификатор аллокации.
   - `months_to_show`: **целое число**, количество месяцев, на которые будет показан прогноз.
   - `filter_rules`: **словарь** с фильтрами для прогноза.

6. **HTTP метод POST**: `/api/predict/building`  
   Реализует поиск спрогнозированных объектов по зданиям. На вход подаются:
   - `searchable_value`: **строка**, значение для поиска.
   - `alloc_id`: **UUID**, идентификатор аллокации.
   - `months_to_show`: **целое число**, количество месяцев, на которые будет показан прогноз.
   - `filter_rules`: **словарь** с фильтрами для прогноза.

## Заключение
&emsp;Наш сервис для распределения и аллокации расходов компании — это мощный инструмент, который помогает эффективно управлять финансовыми ресурсами. Он позволяет не только улучшить отчетность, но и прогнозировать будущие расходы, обеспечивая стабильность и финансовую прозрачность в бизнесе. Мы уверены, что внедрение этой системы значительно повысит финансовую эффективность вашей компании.

## Лицензия
[MIT License](https://github.com/ildimas/LCT_Beverly_Hills_Misis_11_Backend/blob/main/LICENSE)
